# 4-教育项目数仓为(离线数仓业务)

## 如何从业务人员需求提取关键指标

* 业务人员或运营等提出一些数据分析指标
* 1-总访问客户量
* 2-地区访问客户热力图
* 3-访客咨询率趋势
* 4-访问客户量和访客咨询率双轴趋势
* 5-时间段访问客户量趋势
* 6-搜索来源访问量占比
* 7-来源渠道访问量占比
* 8-活跃页面排行榜
* **作为开发根据上述8 个指标进行分析：**
* 1-访问客户量
  * 根据年月日进一步提取就可(下钻到不同的时间段)
* 2-咨询客户量
  * 根据时间下钻到不同时间段分析
* ![image-20200902101707769](04-教育项目数仓(离线数仓业务).assets/image-20200902101707769.png)

* ![image-20200902101949356](04-教育项目数仓(离线数仓业务).assets/image-20200902101949356.png)

## 建模分析

* ![image-20200902111049017](04-教育项目数仓(离线数仓业务).assets/image-20200902111049017.png)

* ODS
* ![image-20200902110454191](04-教育项目数仓(离线数仓业务).assets/image-20200902110454191.png)
* DWD
* ![image-20200902103225219](04-教育项目数仓(离线数仓业务).assets/image-20200902103225219.png)
* DWS+APP
* ![image-20200902110512232](04-教育项目数仓(离线数仓业务).assets/image-20200902110512232.png)
* Sqoop到MySQL
* ![image-20200902110536602](04-教育项目数仓(离线数仓业务).assets/image-20200902110536602.png)
* OOZIE定时调度
* ![image-20200902110626953](04-教育项目数仓(离线数仓业务).assets/image-20200902110626953.png)
* BI报表展示
* ![image-20200902110553020](04-教育项目数仓(离线数仓业务).assets/image-20200902110553020.png)

## 访问客户量实现

* 抽取咨询原始数据到ODS层以后，如何分析出对应维度的数据呢？ 

  我们可以采取结果导向的方式来进行倒推： 

  1．最终的数据维度：年、季度、月、日、小时、年区间内小时、季度区间内小时、月区间内 

  小时、天区间内小时、地区、来源渠道、搜索来源、会话来源页面； 

  2．**首先要有DWD层对ODS原始数据进行清洗和转换，作为我们的明细数据**； 

  3．维度我们可以分为两类：固定时间维度（年、季度、月、日、区间小时）和产品属性维度（地 

  区、来源渠道、搜索来源、会话来源页面）； 

  4．我们可以将产品属性维度和最小的时间粒度（小时）来统计，作为共享表，放置在DWM层； 

  5．后续如果有新的共享维度数据，可以继续添加在DWM层； 

  6．在DWM层小时数据的基础上，进行上卷sum统计（年、季度、月、日、区间小时），即可 

  得到DWS层的数据集市； 

  7．注意：最终的数据要求在统计之前，要先根据客户进行去重，这也对我们的中间层进行了 

  限制，不能简单的先按天去重count，然后再按月和年sum，因为不同天的客户可能存在重复，直 

  接sum会导致结果不正确； 

  8．因此DWM层先按小时来去重，再在DWS中sum的结果是不正确的； 

  9．所以DWM层不进行count，那么如果将DWD客户去重后的数据，直接保存为中间表呢？也 

  会存在问题，因为如果DWM层把全表的用户去重后，在DWS层的数据会存在丢失减少的情况，比 

  如小时数据和天数据。 

  ``` properties
  		小案例: 
           2020-10-10 15  s01  
           2020-10-10 15  s02
           2020-10-10 16  s01
           2020-10-10 16  s03
           2020-10-11 10  s02
           2020-10-11 11  s04
           
         统计, 每个小时有几个用户数据呢?
            2020-10-10 15  2
            2020-10-10 16  2
            2020-10-11 10  1
            2020-10-11 11  1
         统计, 每天有几个用户呢? 
             正确结果:
                2020-10-10  3
                2020-10-11  2
             但是, 如果使用每个小时的统计结果, 来计算:
               2020-10-10  4
               2020-10-11  2
               此时, 会发现有问题了....
               
  此时发现, 在此层, 既不能做维度退化, 也不能进行提前聚合, 所以 不需要DWM层
  ```
  
  
  
  10．DWS层直接根据DWD的数据进行统计，得出数据集市；

## 咨询客户量实现

* 扩展
* ![image-20200902110240959](04-教育项目数仓(离线数仓业务).assets/image-20200902110240959.png)

## 总结

* 大家如果后续教育项目能够帮助到你，就需要按照老师讲解的流程进行分析

